# Telegram MiniApp: ะะฝัะตัะฐะบัะธะฒะฝัะต ะััะพัะธะธ

ะะพะปะฝะพัะตะฝะฝะพะต Telegram MiniApp ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝัั ัะฐั-ะธััะพัะธะน ั ะตะถะตะดะฝะตะฒะฝัะผะธ ัะตััะธัะผะธ ะฟะพ 20-30 ะผะธะฝัั.

## ๐ฏ ะะพะทะผะพะถะฝะพััะธ

### ะะปั ะธะณัะพะบะพะฒ
- ๐ ะัะพัะผะพัั ะธ ะฒัะฑะพั ะธััะพัะธะน
- ๐ฌ ะงะฐั-ััะธะปั ะฟะปะตะตั ั ัะพะพะฑัะตะฝะธัะผะธ, ะฒัะฑะพัะฐะผะธ ะธ ะฒะฒะพะดะพะผ ัะตะบััะฐ
- โฑ๏ธ ะญััะตะบัั: ะฟะตัะฐัั, ะฟะฐัะทั, ะทะฐะดะตัะถะบะธ
- ๐ ะกัะฐัะธััะธะบะฐ ะฒัะฑะพัะพะฒ ะดััะณะธั ะธะณัะพะบะพะฒ ะฒ ะบะพะฝัะต ะดะฝั
- ๐พ ะกะพััะฐะฝะตะฝะธะต ะฟัะพะณัะตััะฐ ะธ ัะปะฐะณะพะฒ ะดะปั ะฒะตัะฒะปะตะฝะธั

### ะะปั ะฐะฒัะพัะพะฒ (Admin CMS)
- โ๏ธ ะกะพะทะดะฐะฝะธะต ะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะธััะพัะธะน ะธ ะดะฝะตะน
- ๐ DSL-ะฟะฐััะตั ะดะปั ะธะผะฟะพััะฐ ัะตะปัั ัะบัะธะฟัะพะฒ ะดะฝะตะน
- โ ะะฐะปะธะดะฐัะธั ััะตะฝ ะธ ะฟะตัะตัะพะดะพะฒ
- ๐ ะัะฑะปะธะบะฐัะธั ั ัะพะทะดะฐะฝะธะตะผ ะฝะตะธะทะผะตะฝัะตะผัั ัะฝะฐะฟัะพัะพะฒ
- ๐ ะะฐะทะพะฒะฐั ะฐะฝะฐะปะธัะธะบะฐ

## ๐๏ธ ะขะตัะฝะพะปะพะณะธะธ

- **Frontend**: Next.js 15 (App Router), TypeScript, Tailwind CSS
- **Backend**: Supabase (PostgreSQL + Auth + RLS)
- **Auth**: Telegram initData verification (HMAC-SHA256)

## ๐ฆ ะฃััะฐะฝะพะฒะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะทะฐะฒะธัะธะผะพััะธ

```bash
cd "tg miniapp"
npm install
```

### 2. ะะฐัััะพะนะบะฐ Supabase

1. ะกะพะทะดะฐะนัะต ะฟัะพะตะบั ะฝะฐ [supabase.com](https://supabase.com)
2. ะัะฟะพะปะฝะธัะต SQL ะธะท `supabase/schema.sql` ะฒ SQL Editor
3. ะกะบะพะฟะธััะนัะต URL ะธ ะบะปััะธ

### 3. ะะฐัััะพะนะบะฐ Telegram Bot

1. ะกะพะทะดะฐะนัะต ะฑะพัะฐ ัะตัะตะท [@BotFather](https://t.me/BotFather)
2. ะะบะปััะธัะต MiniApp: Bot Settings โ Menu Button โ Edit menu button URL
3. ะกะบะพะฟะธััะนัะต ัะพะบะตะฝ ะฑะพัะฐ

### 4. ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะกะพะทะดะฐะนัะต `.env.local`:

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Telegram Bot
TELEGRAM_BOT_TOKEN=your-bot-token

# App URL
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
```

### 5. ะะพะฑะฐะฒะปะตะฝะธะต ะฐะดะผะธะฝะฐ

ะะพัะปะต ะฟะตัะฒะพะณะพ ะฒัะพะดะฐ ัะตัะตะท Telegram, ะฝะฐะนะดะธัะต ะฒะฐั user_id ะฒ ัะฐะฑะปะธัะต `users` ะธ ะดะพะฑะฐะฒััะต ะฒ ะฐะดะผะธะฝั:

```sql
INSERT INTO admin_users (user_id, role) 
VALUES ('ะฒะฐั-user-uuid', 'admin');
```

### 6. ะะฐะฟััะบ

```bash
npm run dev
```

ะัะบัะพะนัะต [http://localhost:3000](http://localhost:3000)

ะะปั ัะตััะฐ ะฒ Telegram ะธัะฟะพะปัะทัะนัะต ngrok ะธะปะธ deploy ะฝะฐ Vercel.

## ๐ DSL ะกะธะฝัะฐะบัะธั ัะบัะธะฟัะพะฒ

### ะกะพะพะฑัะตะฝะธั

```
NPC: ะขะตะบัั ัะพะพะฑัะตะฝะธั ะพั NPC
ME: ะขะตะบัั ัะพะพะฑัะตะฝะธั ะธะณัะพะบะฐ (ะฟัะตะดะทะฐะดะฐะฝะฝัะน)
SYS: ะกะธััะตะผะฝะพะต ัะพะพะฑัะตะฝะธะต (ะฟะพ ัะตะฝััั)
```

### ะญััะตะบัั

```
...                    // ะะฝะดะธะบะฐัะพั ะฟะตัะฐัะธ (1.2 ัะตะบ)
[pause 10s]           // ะะฐัะทะฐ 10 ัะตะบัะฝะด
[delay 800ms]         // ะะฐะดะตัะถะบะฐ ะฟะตัะตะด ัะปะตะดัััะธะผ ัะพะพะฑัะตะฝะธะตะผ
[typing 1500ms]       // ะะฐััะพะผะฝะพะต ะฒัะตะผั ะฟะตัะฐัะธ
[bg noir]             // ะกัะธะปั ัะพะฝะฐ (noir/romance/thriller/mystery)
```

### ะะตัะตัะพะดั ะธ ัะตะณะธ

```
NPC: ะะฐะถะฝะฐั ัะพัะบะฐ #tag:important_point  // ะะตัะบะฐ ะดะปั ะฟะตัะตัะพะดะฐ
```

### ะัะฑะพั

```
CHOICE:
- ะะฐัะธะฐะฝั 1 -> goto tag1 [set mood=happy]
- ะะฐัะธะฐะฝั 2 -> goto tag2 [set flag:angry=true]
```

### ะะฒะพะด ัะตะบััะฐ

```
INPUT: ะะฐะบ ัะตะฑั ะทะพะฒัั? -> goto after_name [set name_entered=true]
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
src/
โโโ app/
โ   โโโ page.tsx              # ะะปะฐะฒะฝะฐั (ัะฟะธัะพะบ ะธััะพัะธะน)
โ   โโโ story/[storyId]/      # ะกััะฐะฝะธัะฐ ะธััะพัะธะธ
โ   โโโ play/[storyId]/[day]/ # ะงะฐั-ะฟะปะตะตั
โ   โโโ admin/                # CMS ะฐะดะผะธะฝะบะฐ
โโโ components/
โ   โโโ player/               # ะะพะผะฟะพะฝะตะฝัั ะฟะปะตะตัะฐ
โ   โโโ admin/                # ะะพะผะฟะพะฝะตะฝัั ะฐะดะผะธะฝะบะธ
โโโ lib/
โ   โโโ actions/              # Server actions
โ   โโโ auth/                 # ะกะตััะธะธ ะธ ะฐะฒัะพัะธะทะฐัะธั
โ   โโโ parser/               # DSL ะฟะฐััะตั
โ   โโโ supabase/             # Supabase ะบะปะธะตะฝัั
โ   โโโ telegram/             # Telegram ะธะฝัะตะณัะฐัะธั
โ   โโโ types/                # TypeScript ัะธะฟั
```

## ๐งช ะขะตััั

```bash
npm test                 # ะะฐะฟััะบ ัะตััะพะฒ
npm run test:watch       # ะะตะถะธะผ ะฝะฐะฑะปัะดะตะฝะธั
```

## ๐ ะะตะฟะปะพะน

### Vercel (ัะตะบะพะผะตะฝะดัะตััั)

1. Push ะฒ GitHub
2. Import ะฒ Vercel
3. ะะพะฑะฐะฒััะต env variables
4. Deploy

### Telegram MiniApp

1. ะะพะปััะธัะต ะฟัะฑะปะธัะฝัะน URL (ะฝะฐะฟัะธะผะตั, `https://your-app.vercel.app`)
2. ะัะบัะพะนัะต @BotFather
3. Bot Settings โ Menu Button โ Edit menu button URL
4. ะััะฐะฒััะต URL

## ๐ ะััะธัะตะบัััะฐ ะดะฐะฝะฝัั

### ะัะฝะพะฒะฝัะต ัะฐะฑะปะธัั

- `stories` โ ะธััะพัะธะธ
- `days` โ ะดะฝะธ/ัะฟะธะทะพะดั
- `scenes` โ ััะตะฝั (ัะพะพะฑัะตะฝะธั, ะฒัะฑะพัั, ะฟะฐัะทั)
- `choices` โ ะฒะฐัะธะฐะฝัั ะฒัะฑะพัะฐ
- `progresses` โ ะฟัะพะณัะตัั ะธะณัะพะบะพะฒ
- `snapshots` โ ะพะฟัะฑะปะธะบะพะฒะฐะฝะฝัะต ะฒะตััะธะธ ะดะฝะตะน

### Row Level Security

- ะะณัะพะบะธ ะฒะธะดัั ัะพะปัะบะพ ะพะฟัะฑะปะธะบะพะฒะฐะฝะฝัะต ะธััะพัะธะธ
- ะะดะผะธะฝั (ัะตัะตะท service role) ะธะผะตัั ะฟะพะปะฝัะน ะดะพัััะฟ
- ะัะพะณัะตัั ะดะพัััะฟะตะฝ ัะพะปัะบะพ ะฒะปะฐะดะตะปััั

## ๐จ ะะฐััะพะผะธะทะฐัะธั

### ะกัะธะปะธ ัะพะฝะฐ

ะะพะฑะฐะฒััะต ะฒ `globals.css`:

```css
.bg-custom {
  background: linear-gradient(...);
}
```

ะ ะฒ DSL:

```
[bg custom]
```

### ะะผะตะฝะฐ NPC

ะะทะผะตะฝะธัะต ะฒ `MessageBubble.tsx` ััะฝะบัะธั `getSpeakerName()`.

## ๐ ะะธัะตะฝะทะธั

MIT

---

ะกะพะทะดะฐะฝะพ ั โค๏ธ ะดะปั Telegram
